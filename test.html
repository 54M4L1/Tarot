<!DOCTYPE html>

<html lang="ar" dir="rtl" style="cursor: url('/icons8-select-cursor-32.png'), auto;

">
<head>
        
        
             <link rel="manifest" href="manifest.json">

    <meta name="facebook-domain-verification" content="zys1uwlffs8gs0xrqhgwpsf4o01e2q" />    
    <link rel="icon" href="/watcher.gif" type="image/x-icon">  
    <meta property="og:title" content="مشروع التاروت الكمي" />
    <meta property="og:description" content="قارئ التاروت بالذكاء الأصطناعي والخوارزميات الكمومية" />
    <meta property="og:url" content="https://www.forum.psychicalbeacon.com/Tara/index.html" />    
    <meta property="og:image" content="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEii6xc5sQ_0JfGnsgE2cvgqSwVzOzYUYoNMaBD-RiGeo0MuHmiUl6_PNdlUmm0YnKKme51S-MeHZMnHPCfAawU9Y27d1BSUkXBeGGWaV-Lelm7j6_nMzStYI-hmWDADXkSKKiGeilgC9L6acZKE-x8D_OFoWuaiKAtxvJdFbDgw8XBvHMe-pt24Z0CVvXRq/s1168/photo_2025-01-29_21-48-10.jpg" />
    <meta property="og:type" content="website" />
    <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>قارئ التاروت الكمّي</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@400;700&display=swap"
    rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Kufam:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Lateef:wght@200;300;400;500;600;700;800&display=swap');
</style>

  <style>
body {
  font-family: "Kufam", serif;
  background-color: #0a0a1a; /* خلفية داكنة */
  text-align: center;
  padding: 20px;
  margin: 0;
  overflow-x: hidden; /* منع التمرير الأفقي */
  overflow-y: auto; /* السماح بالتمرير العمودي */
  position: relative;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 80' width='80' height='80'%3E%3Cpath fill='%23f5f4f7' fill-opacity='0.2' d='M14 16H9v-2h5V9.87a4 4 0 1 1 2 0V14h5v2h-5v15.95A10 12 0 0 0 23.66 27l-3.46-2 8.2-2.2-2.9 5a12 12 0 0 1-21 0l-2.89-5 8.2 2.2-3.47 2A10 14 0 0 0 14 31.95V16zm40 40h-5v-2h5v-4.13a4 4 0 1 1 2 0V54h5v2h-5v15.95A10 10 0 0 0 63.66 67l-3.47-2 8.2-2.2-2.88 5a12 12 0 0 1-21.02 0l-2.88-5 8.2 2.2-3.47 2A10 10 0 0 0 54 71.95V56zm-39 6a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm40-40a2 2 0 1 1 0-4 2 2 0 0 1 0 4zM15 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm40 40a2 2 0 1 0 0-4 2 2 0 0 0 0 4z'%3E%3C/path%3E%3C/svg%3E");
  background-repeat: repeat; /* تكرار الصورة */
  background-size: auto; /* الحفاظ على الجودة الأصلية */
  background-position: 0 0; /* موضع البداية */
  animation: moveBackground 233s linear infinite; /* تحريك الخلفية */

}

@keyframes moveBackground {
  0% {
    background-position: 0 0; /* موضع البداية */
  }
  100% {
    background-position: 0px 10000px; /* تحريك الصورة للأمام */
  }
}

.h1-container {
  display: flex;
  align-items: center; /* محاذاة النص والصورة عموديًا */
  justify-content: center; /* محاذاة النص والصورة أفقيًا */
}

.h1 {
  color: #ffffff;
  text-shadow: 0 0 12px #00e6ff, 0 0 24px #0099cc;
  font-size: 36px; /* حجم النص */
  margin-right: 20px; /* المسافة بين النص والصورة */
  padding-left: 20px;      
}

.image {
    width: 40px;
    height: 40px;
    background-color: white;
        border-radius: 100%;
  object-fit: cover; /* لضمان أن الصورة تناسب الحجم المحدد */
}

          
          
.subheading {
  font-size: 1.2em;
  color: #a0a0a0; /* لون نص رمادي فاتح */
}

.card {
  display: inline-block;
  margin: 10px;
  width: 150px;
  height: 266px;
  background-color: rgba(255, 255, 255, 0.1); /* خلفية شفافة */
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 10px;
  padding: 10px;
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.3); /* توهج أزرق */
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-10px);
  box-shadow: 0 0 30px rgba(0, 255, 255, 0.6); /* توهج أقوى عند التحويم */
}

.card img {
  width: 100%;
  height: auto;
  border-radius: 5px;
}

.btn {
    margin: auto;
    padding: 7px 16px;
    margin-bottom: 20px;
    margin-top: 30px;    
    background-color: #1a1a2e;
    color: #00ffff;
                    cursor: url('/icons8-cursor-32%20%281%29.png'), auto;

    border: 1px solid #00ffff;
    border-radius: 30px;
    font-weight: bold;
    display: block;
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

.btn:hover {
  background-color: #00ffff; /* لون خلفية أزرق كهربائي */
  color: #1a1a2e; /* لون نص داكن */
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.6); /* توهج أزرق */
}
          
.btn:disabled, .btn.loading {
    background-color: gray !important;
    color: black;
    cursor: not-allowed;
    border: none;    
}

.btn:disabled:hover, .btn.loading:hover { /* لون خلفية أزرق كهربائي */
  box-shadow: none; /* تعطيل تأثير الـ hover */
  border: none;
}

     

#results {
  margin-top: 20px;
  background-color: rgba(26, 26, 46, 0.8); /* خلفية داكنة شفافة */
  color: #e0e0e0;
  font-family: 'Amiri', sans-serif;
  font-size: 18px;
  line-height: 1.8;    
  padding: 20px;     
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.3); /* توهج أزرق */
  border: 1px solid rgba(255, 255, 255, 0.2);
}
          #results p {
  margin-bottom: 15px;
}

#results strong {
  font-size: 1.1em;
  color: #89b9cd;
  display: inline-block;
  margin-top: 10px;
}

#results em {
  font-style: italic;
}

#loading {
  font-size: 20px;
  color: #00ffff; /* لون أزرق كهربائي */
  background-color: #000; /* لون خلفية أسود */
  padding: 15px 20px; /* تباعد داخلي */
  border-radius: 8px; /* زوايا مستديرة */
  display: none; /* مخفي افتراضيًا */
  border: 2px solid #00ffff; /* إطار أزرق كهربائي */
  text-align: center;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
          @media (max-width: 600px) {
  #loading {
    font-size: 14px; /* تصغير حجم الخط */
    padding: 10px 15px; /* تقليل التباعد الداخلي */
    width: 80%; /* تصغير العرض ليكون مناسبًا */
    max-width: 300px; /* تحديد الحد الأقصى للعرض */
  }
}




#readingType {
  background-color: rgba(255, 255, 255, 0.1); /* خلفية شفافة */
  color: #e0e0e0;
  border: 1px solid rgba(255, 255, 255, 0.2);
  padding: 10px;
  text-align: end;
  font-size: 16px;
  font-family: 'Amiri', sans-serif;
  border-radius: 8px;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M7%2010l5%205%205-5z%22%20fill%3D%22%23e0e0e0%22%2F%3E%3C%2Fsvg%3E"); /* سهم بلون فاتح */
  background-repeat: no-repeat;
  background-position-x: calc(100% - 10px);
  background-position-y: center;
  padding-right: 40px;
  transition: all 0.3s ease;
  box-shadow: 0 0 10px rgba(0, 255, 255, 0.3); /* توهج أزرق */
                    cursor: url('/icons8-cursor-32%20%281%29.png'), auto;
}

#readingType:hover {
  background-color: rgba(255, 255, 255, 0.2); /* خلفية أفتح عند التحويم */
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.6); /* توهج أقوى */
}

#readingType:focus {
  outline: none;
  border-color: #00ffff; /* لون أزرق كهربائي */
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.6); /* توهج أزرق */
}
          
          #readingType option {
  background-color: #0a0a1a; /* خلفية داكنة */
  color: #e0e0e0; /* لون النص */
  font-family: 'Amiri', sans-serif; /* الخط */
  padding: 10px;
}
          
#errormessage {
  position: fixed;
  top: 80%;
  left: 50%;
        width: 60%;
  transform: translate(-50%, -50%);
  background-color: rgba(255, 0, 0, 0.8);
  color: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  z-index: 1000;
}
#errormessage a {
  color: yellow;
  text-decoration: underline;
}
     
         
 .bu5tton {
    background-color: #0d9ea6;  /* اللون الأخضر */
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s ease, transform 0.2s;
  }

  .bu5tton:hover {
    background-color: #3ba1a5b3;  /* تغيير اللون عند المرور */
    transform: scale(1.05);  /* زيادة حجم الزر قليلاً */
  }

  .bu5tton:active {
    background-color: #0d9ea6;  /* تغيير اللون عند الضغط */
  }          
      
          
#terms-content ul li {
    margin-bottom: 10px; /* يمكنك تعديل القيمة حسب الحاجة */
}
          
          
          
          #terms-modal {

    max-width: 90%; /* هذا يضمن أن العرض لن يتجاوز 90% من الشاشة */
    box-sizing: border-box; /* لتفادي المشاكل مع الحواف padding */
}

@media (max-width: 600px) {
    #terms-modal {
        width: 90%; /* يجعل العرض يتناسب مع شاشة الهواتف */
        padding: 15px; /* تقليل الحواف لتوفير مساحة أكبر */
    }
}

.ElectricText {
    font-size: 16px;
    font-weight: bold;
    font-family: "Kufam", serif;
    background: linear-gradient(90deg, rgba(7, 193, 199, 1) 0%, rgba(36, 232, 238, 1) 50%, rgb(10 10 26) 100%);
    background-size: 300% 100%;
  animation: gradientMove 20s ease-in-out infinite; /* تحريك التدرج بسلاسة */
  -webkit-background-clip: text;
  color: transparent;
}

/* التدرج المتحرك من اليمين لليسار والعودة */
@keyframes gradientMove {
  0% {
    background-position: 300% 0%; /* يبدأ من اليمين */
  }
  50% {
    background-position: 0% 0%; /* يصل إلى اليسار */
  }
  100% {
    background-position: 300% 0%; /* يعود إلى اليمين */
  }
}



          .EleText {
  font-size: 16px;
  font-weight: bold;
  font-family: "Kufam", serif;
  background-color: #01d7d8;
  background-size: 200% 100%;
  -webkit-background-clip: text;
  color: transparent;
}


          
          
          
          
          
          /* الإعدادات العامة للزر */
#add-to-home-screen {
  position: fixed;
  top: 10px;  /* المسافة من الأعلى */
  left: 10px;  /* المسافة من اليسار */
  background-color: transparent;  /* الخلفية شفافة */
  border: none;  /* إزالة الحدود */
  padding: 0;  /* إزالة الحشو */
  z-index: 9999;  /* للتأكد من أنه يظهر فوق جميع العناصر الأخرى */
  cursor: pointer;
  display: none; /* إخفاء الزر بشكل افتراضي */
}

#add-to-home-screen img {
  width: 30px;  /* حجم الصورة */
  height: 30px;  /* حجم الصورة */
      background-color: #489a9a;
    border-radius: 50%;      
}

#add-to-home-screen:hover {
  opacity: 0.8;  /* تأثير تمرير الماوس على الزر */
}

/* استعلام الوسائط لعرض الزر فقط على الأجهزة المحمولة */
@media (max-width: 768px) {
  #add-to-home-screen {
    display: block;  /* عرض الزر على الشاشات الصغيرة */
  }
}      
          
          
          
   
          
                    #results .error {
    color: red !important;
    font-weight: bold;
    background-color: rgba(255, 0, 0, 0.1);
    padding: 10px;
    border: 1px solid red;
    border-radius: 5px;
    margin-top: 10px;
          
    
          }
          
.shot {
    display: none; /* إخفاء الزر افتراضيًا */
    position: fixed;
    background-color: #1f2e1a;
    color: #f5fff5;
    cursor: pointer;
    padding: 7px 10px;
    bottom: 10px;
    left: 10px;
    border: 1px solid #4bff00;
    border-radius: 30px;
    font-weight: bold;
}
               
          

          
  </style>
</head>

<body>
        
        
<button id="add-to-home-screen" style="display: none;">
  <img src="https://img.icons8.com/color/48/software-installer.png" alt="Add to Home" style="width: 30px; height: 30px;">
</button>

        
        
        <button id="premium-button" style="
  position: fixed;
  top: 10px;
  right: 10px;
  background-color: #489a9a;
  color: white;
  border: none;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  font-size: 16px;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
">🔑</button>
        
<div id="secret-code-modal" style="display: none; position: fixed; top: 50%; left: 50%; 
                                    transform: translate(-50%, -50%); background-color: #fff; 
                                    padding: 30px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); 
                                    z-index: 10000; max-width: 400px; width: 100%; text-align: center;">

    <label for="secret-code-input" style="font-size: 18px; color: #333; font-weight: bold; display: block; margin-bottom: 15px;">
        أدخل رمز العضوية:
    </label>

    <input type="text" id="secret-code-input" placeholder="الرمز السري" 
           style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #ddd; 
                  border-radius: 5px; margin-bottom: 20px; box-sizing: border-box; outline: none; 
                  transition: border-color 0.3s ease;">
<button onclick="checkSecretCode()" class="bu5tton">تفعيل</button>
<button onclick="closeSecretCodeModal()" class="bu5tton">إغلاق</button>
</div>
<div class="h1-container">
  <img src="/watcher-unscreen.gif" alt="Image" class="image"> <!-- الصورة على اليسار -->
  <h1 class="h1">مشروع التاروت الكمّي</h1>
  <img src="/watcher-unscreen.gif" alt="Image" class="image"> <!-- الصورة على اليمين -->
</div>

    <span class="ElectricText"> بتفانٍ وحب، تم تَطوير البرنامج بواسطة سام علي</span> <!-- الخلفية ستظهر داخل النص فقط -->

 
          
<form id="tarotForm" onsubmit="event.preventDefault();">
    <input type="hidden" id="cardNamesInput" name="cardNames">
    <input type="hidden" id="isPremiumUserInput" name="isPremiumUser">
    
    <!-- الأزرار المعدلة بحيث يتم استدعاء checkUsageLimit و generateCards مباشرةً -->
    <button class="btn" type="button" onclick="handleClick('simple');">سحب (3 بطاقات)</button>
<button class="btn" type="button" onclick="handleClick('detailed');">سحب (8 بطاقات)</button>

    <p id="loading"></p>
    <label for="readingType"></label>
    <select id="readingType" name="readingType">
        <option value="general" selected>قراءة عامة</option>
        <option value="love">الحياة العاطفية</option>
        <option value="career">الحياة المهنية</option>
    </select>
</form>
        
        
        
        
<div id="terms-modal" style="display: none; position: fixed; top: 50%; left: 50%; 
                            transform: translate(-50%, -50%); background-color: white; 
                            padding: 20px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); 
                            z-index: 10000; width: 400px;">
    <h3>أهلا بك في مشروع التاروت الكميّ</h3>
    <div id="terms-content" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
        <p>يرجى قراءة التعليمات أدناه بعناية قبل بدء الإستخدام:</p>
        <ul>
            <li>مستقبلك بيديك, وقارئ التاروت فقط سيقدم لك نصائح وآراء بناءاً على البطاقات التي يتم إختيارها من قِبلك, بإستخدام الخوارزميات الكميّة.</li>
            <li>لتقليل التكاليف والموارد قمنا بوضع حد يومي للقراءات 4 مرات يومياً, يمكن فقط للأعضاء المشتركين إستخدام الخدمة دون توقف.</li>
            <li>قبل أن تقوم بسحب البطاقات إسترخِ جسمك وعقلك وحدد بوضوح النية من القراءة, أما دون ذلك فلن تحصل على نتيجة دقيقة وواقعية.</li>
            <li>كن على دراية بأن هنالك روابط حية بين الأبعاد, منها ما سيمرر إليك البطاقات التي تتوافق حقاً مع موقفك الحالي.</li>    
        </ul>
    </div>
    <div>
        <label for="accept-checkbox">
            <input type="checkbox" id="accept-checkbox"> فهمت التعليمات وأوافق على الإستمرار
        </label>
    </div>
    <button style="margin-top: 20px;" id="accept-terms" disabled>تمام</button>
</div>

<div id="cardsContainer"></div>
<button class="shot" id="capture-btn">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
        <path d="M.5 9.9V14a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1V9.9a.5.5 0 0 1 1 0V14a2 2 0 0 1-2 2H1.5a2 2 0 0 1-2-2V9.9a.5.5 0 0 1 1 0zm7.646-1.646 3-3a.5.5 0 0 0-.707-.708L8.5 7.793V1.5a.5.5 0 0 0-1 0v6.293L5.56 4.56a.5.5 0 1 0-.707.708l3 3a.5.5 0 0 0 .707 0z"/>
    </svg>
</button>

        <div id="errormessage" style="display: none;"></div>
<div id="loading"></div>
<div id="messageContainer"></div>
        <div id="results"></div>

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://js.puter.com/v2/"></script>
<script>
        
        const captureButton = document.querySelector('.shot');
const cardContainer = document.getElementById('cardsContainer');

// مراقبة التغييرات داخل حاوية البطاقات
const observer = new MutationObserver(() => {
    const cards = cardContainer.querySelectorAll('img'); // التحقق من وجود صور داخل الحاوية
    if (cards.length > 0) {
        captureButton.style.display = 'block'; // إظهار الزر بعد ظهور البطاقات
    } else {
        captureButton.style.display = 'none'; // إخفاء الزر عند عدم وجود بطاقات
    }
});

// البدء في المراقبة
if (cardContainer) {
    observer.observe(cardContainer, { childList: true, subtree: true });
}

        
        
        
        

document.getElementById('capture-btn').addEventListener('click', function() {
    var captureElement = document.querySelector('#cardsContainer');
    html2canvas(captureElement).then(function(canvas) {
        var ctx = canvas.getContext('2d');
        var logo = new Image();
        logo.src = '/36335539_187375658777155_1923247554414247936_n.jpg'; // مسار اللوجو

        logo.onload = function() {
            var logoWidth = logo.width / 5; // تصغير العرض إلى 1/5 من الحجم الأصلي
            var logoHeight = logo.height / 5; // تصغير الارتفاع إلى 1/5 من الحجم الأصلي

            // حفظ محتوى الصورة الأصلية
            var originalCanvas = document.createElement('canvas');
            var originalCtx = originalCanvas.getContext('2d');
            originalCanvas.width = canvas.width;
            originalCanvas.height = canvas.height;
            originalCtx.drawImage(canvas, 0, 0); // رسم محتوى الصورة الأصلية في القماش الجديد

            // زيادة ارتفاع الصورة لإضافة الفوتر
            var footerHeight = 50; // ارتفاع الفوتر
            canvas.height = originalCanvas.height + footerHeight; // إضافة ارتفاع الفوتر
            ctx.drawImage(originalCanvas, 0, 0); // نقل محتوى الصورة الأصلية إلى الـ canvas الجديد

            // رسم الفوتر في أسفل الصورة
            ctx.fillStyle = "black"; // لون الفوتر
            ctx.fillRect(0, originalCanvas.height, canvas.width, footerHeight); // رسم الفوتر في أسفل الصورة

            // إضافة النص داخل الفوتر (محاذاة اليسار)
            ctx.font = "20px Arial";
            ctx.fillStyle = "white"; // تغيير اللون إذا رغبت
            ctx.textAlign = "left"; // محاذاة النص إلى اليسار
            ctx.fillText("© 2025 Sam Ali - PsychicalBeacon.com ", 20, originalCanvas.height + footerHeight - 20);

            // رسم الشعار في الفوتر في الجهة اليمنى
            ctx.drawImage(logo, canvas.width - logoWidth - 20, originalCanvas.height + footerHeight - logoHeight - 20, logoWidth, logoHeight);

            // تحميل الصورة
            var imageUrl = canvas.toDataURL("image/png");
            var downloadLink = document.createElement('a');
            downloadLink.href = imageUrl;
            downloadLink.download = 'tarot_result.png';
            downloadLink.click();
        };
    });
});
        
        
        
        
        
        
 
        
        
        
window.onload = function() {
  // التحقق مما إذا كانت الموافقة موجودة في localStorage
  const isTermsAccepted = localStorage.getItem('termsAccepted');
  
  // إذا لم يكن المستخدم قد وافق على الشروط من قبل، عرض النافذة
  if (!isTermsAccepted) {
    const termsModal = document.getElementById('terms-modal');
    const acceptButton = document.getElementById('accept-terms');
    const acceptCheckbox = document.getElementById('accept-checkbox');
    
    termsModal.style.display = 'block';  // عرض النافذة المنبثقة

    // تمكين الزر فقط عندما يتم تفعيل المربع
    acceptCheckbox.addEventListener('change', function() {
      acceptButton.disabled = !acceptCheckbox.checked;  // تمكين أو تعطيل الزر بناءً على حالة المربع
    });

    // التعامل مع حدث زر الموافقة
    document.getElementById('accept-terms').onclick = function() {
      // تخزين الموافقة في localStorage
      localStorage.setItem('termsAccepted', 'true');
      // إخفاء النافذة بعد الموافقة
      termsModal.style.display = 'none';
    };
  }
};


        
        
        
        
  const SECRET_CODES = {
    '': { accessLevel: 'admin', validUntil: '2030-12-31' },
};
  const geminiApiKey = 'AIzaSyAP-2Q3kmQoJuAda6wPlLxqBHue7Almr7Q'; 
  let isPremiumUser = false;

  const cards = [
    "00_Fool", "01_Magician", "02_High_Priestess", "03_Empress", "04_Emperor", 
    "05_Hierophant", "06_Lovers", "07_Chariot", "08_Strength", "09_Hermit", 
    "10_Wheel_of_Fortune", "11_Justice", "12_Hanged_Man", "13_Death", "14_Temperance", 
    "15_Devil", "16_Tower", "17_Star", "18_Moon", "19_Sun", "20_Judgement", 
    "21_World", "22_Ace_of_Wands", "23_Two_of_Wands", "24_Three_of_Wands", 
    "25_Four_of_Wands", "26_Five_of_Wands", "27_Six_of_Wands", "28_Seven_of_Wands", 
    "29_Eight_of_Wands", "30_Nine_of_Wands", "31_Ten_of_Wands", "32_Page_of_Wands", 
    "33_Knight_of_Wands", "34_Queen_of_Wands", "35_King_of_Wands", "36_Ace_of_Pentacles", 
    "37_Two_of_Pentacles", "38_Three_of_Pentacles", "39_Four_of_Pentacles", "40_Five_of_Pentacles", 
    "41_Six_of_Pentacles", "42_Seven_of_Pentacles", "43_Eight_of_Pentacles", "44_Nine_of_Pentacles", 
    "45_Ten_of_Pentacles", "46_Page_of_Pentacles", "47_Knight_of_Pentacles", "48_Queen_of_Pentacles", 
    "49_King_of_Pentacles", "50_Ace_of_Cups", "51_Two_of_Cups", "52_Three_of_Cups", 
    "53_Four_of_Cups", "54_Five_of_Cups", "55_Six_of_Cups", "56_Seven_of_Cups", 
    "57_Eight_of_Cups", "58_Nine_of_Cups", "59_Ten_of_Cups", "60_Page_of_Cups", 
    "61_Knight_of_Cups", "62_Queen_of_Cups", "63_King_of_Cups", "64_Ace_of_Swords", 
    "65_Two_of_Swords", "66_Three_of_Swords", "67_Four_of_Swords", "68_Five_of_Swords", 
    "69_Six_of_Swords", "70_Seven_of_Swords", "71_Eight_of_Swords", "72_Nine_of_Swords", 
    "73_Ten_of_Swords", "74_Page_of_Swords", "75_Knight_of_Swords", "76_Queen_of_Swords", 
    "77_King_of_Swords"
  ];

document.getElementById('premium-button').addEventListener('click', function() {
    document.getElementById('secret-code-modal').style.display = 'block';
});

// التحقق من الرمز السري
function checkSecretCode() {
    const inputCode = document.getElementById('secret-code-input').value;
    if (SECRET_CODES[inputCode]) {  // التحقق من وجود الرمز في الكائن
        isPremiumUser = true;
        showSuccessMessage('تم تفعيل الوضع المميز!');
        document.getElementById('premium-button').disabled = false;  // تمكين زر الوضع المميز
        closeSecretCodeModal();
    } else {
        showErrorMessage('الرمز السري غير صحيح. حاول مرة أخرى.');
    }
}


// إغلاق صندوق إدخال الرمز السري
function closeSecretCodeModal() {
    document.getElementById('secret-code-modal').style.display = 'none';
}

// عرض رسالة نجاح
function showSuccessMessage(message) {
    const successMessage = document.createElement('div');
    successMessage.textContent = message;
    successMessage.style.position = 'fixed';
    successMessage.style.top = '50%';
    successMessage.style.left = '50%';
    successMessage.style.transform = 'translate(-50%, -50%)';  // لتوسيط الرسالة تمامًا
    successMessage.style.backgroundColor = '#4CAF50';
    successMessage.style.color = 'white';
    successMessage.style.padding = '10px 20px';
    successMessage.style.borderRadius = '5px';
    successMessage.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.2)';
    successMessage.style.zIndex = '1000';
    document.body.appendChild(successMessage);

    setTimeout(() => {
        successMessage.remove();
    }, 3000);
}


// عرض رسالة خطأ

function showErrorMessage(message) {
  const errorMessageElement = document.getElementById('errormessage');
  
  // عرض الرسالة
  errorMessageElement.innerHTML = message;
  errorMessageElement.style.display = 'block';
  
  // إخفاء الرسالة بعد 10 ثوانٍ
  setTimeout(() => {
    errorMessageElement.style.display = 'none';
  }, 120);  // 10000 ملي ثانية = 10 ثوانٍ
}
// تعيين حد الاستخدام اليومي
function setDailyLimitCookie() {
  const today = new Date().toISOString().split('T')[0]; // الحصول على تاريخ اليوم
  const dailyLimit = 99; // تعيين الحد اليومي إلى 5
  document.cookie = `dailyLimit=${dailyLimit}; expires=${new Date(new Date().setHours(23,59,59,999)).toUTCString()}; path=/;`;
}

// التحقق من الحد اليومي
function checkUsageLimit() {
  const today = new Date().toISOString().split('T')[0];
  let dailyLimit = localStorage.getItem(`dailyLimit_${today}`);

  if (dailyLimit === null) {
    dailyLimit = 99;
  } else {
    dailyLimit = parseInt(dailyLimit, 10);
  }

if (dailyLimit <= 0 && !isPremiumUser) {
showErrorMessage('لقد وصلت إلى الحد اليومي المسموح به. <a href="https://www.psychicalbeacon.com/p/blog-page.html" target="_blank">إدعم المشروع لتحصل على إشتراك دائم</a>');
  return false;
}

  localStorage.setItem(`dailyLimit_${today}`, dailyLimit - 1);
  return true;
}
function displayMessage(message, type = 'error') {
  const resultsContainer = document.getElementById('results');
  if (resultsContainer) {  
    resultsContainer.innerHTML = `<div class="${type}">${message}</div>`; 
  } else {
    console.error('رسالة غير معروضة: لا يوجد عنصر يحمل المعرف results');
  }
}


 
        
        
        
        
        
        
        
        
        
        
        
        
// دالة للتحقق من الوقت المتبقي
function checkTimeRemaining() {
    const lastClickTime = localStorage.getItem('lastClickTime');
    if (!lastClickTime) return 0;

    const currentTime = new Date().getTime();
    const timeElapsed = currentTime - parseInt(lastClickTime, 10);
    const timeRemaining = 10 - timeElapsed; // 60 ثانية

    return timeRemaining > 0 ? timeRemaining : 0;
}

// دالة لتحديث وقت النقر الأخير
function updateLastClickTime() {
    localStorage.setItem('lastClickTime', new Date().getTime());
}

// دالة لتعطيل الأزرار وتحديث العداد
function disableButtons() {
    document.querySelectorAll('.btn').forEach(button => {
        button.disabled = true; // تعطيل الزر
        const timeRemaining = checkTimeRemaining();
        if (timeRemaining > 0) {
            button.textContent = `إسحب مرة أخرى ${Math.ceil(timeRemaining / 1000)} ثانية`;
        }
    });
}

// دالة لتمكين الأزرار وإعادة نصها الأصلي
function enableButtons() {
    document.querySelectorAll('.btn').forEach(button => {
        button.disabled = false; // تمكين الزر
        // إعادة النص الأصلي بناءً على الزر
        if (button.getAttribute('onclick').includes('simple')) {
            button.textContent = '3 بطاقات';
        } else if (button.getAttribute('onclick').includes('detailed')) {
            button.textContent = '8 بطاقات';
        }
    });
}

// دالة لتحديث العداد على الأزرار
function updateButtonTimer() {
    const timeRemaining = checkTimeRemaining();
    if (timeRemaining > 0) {
        document.querySelectorAll('.btn').forEach(button => {
            button.textContent = `إسحب مرة أخرى ${Math.ceil(timeRemaining / 1000)} ثانية`;
        });
        // استمرار تحديث العداد كل ثانية
        setTimeout(updateButtonTimer, 1000);
    } else {
        enableButtons(); // تمكين الأزرار بعد انتهاء العداد
    }
}

async function handleClick(type) {
    if (!checkUsageLimit()) return; // التأكد من الحد المسموح به   
    const timeRemaining = checkTimeRemaining();
    if (timeRemaining > 0) return; // لا تفعل شيئًا إذا كان الوقت لم ينته بعد

    // تعطيل الأزرار وتحديث العداد
    disableButtons();
    updateLastClickTime();

    // بدء تحديث العداد فورًا
    updateButtonTimer();

    // استدعاء دالة توليد البطاقات بناءً على النوع
    await generateCards(type);

    // لا نعيد تمكين الأزرار هنا، بل ننتظر انتهاء العداد
}

// عند تحميل الصفحة، تحقق من الوقت المتبقي وعطل الأزرار إذا لزم الأمر
window.onload = () => {
    const timeRemaining = checkTimeRemaining();
    if (timeRemaining > 0) {
        disableButtons();
        updateButtonTimer(); // بدء تحديث العداد
    }
};     
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
async function generateCards(type) {
  if (!checkUsageLimit()) return;

  const numCards = type === 'simple' ? 3 : 8;
  const loadingElement = document.getElementById('loading');

  // إظهار الصندوق قبل تغيير النص مباشرة
  loadingElement.style.display = "block";
  loadingElement.textContent = 'جاري سحب البطاقات بإستخدام الخوارزميات الكمومية...';

  await new Promise(resolve => setTimeout(resolve, 10));

  loadingElement.textContent = 'جاري تحليل البطاقات...';

  try {
    const selectedCards = getRandomCards(cards, numCards);  // استخدام دالة getRandomCards
    const cardsWithImages = selectedCards.map(cardName => ({
      name: cardName.replace(/_/g, ' ').replace(/^\d+ /, ''),
      image_url: `/Tara/images/deck/${cardName}.jpg`
    }));

    displayCards(cardsWithImages);

    const readingType = document.getElementById('readingType').value;
    const cardNames = cardsWithImages.map(card => card.name);

    let prompt = `أنت خبير في قراءة بطاقات التاروت، وتملك قدرة فريدة على التأثير في نفس القارئ. في كل بطاقة تجد إشارات دقيقة تكشف عن أعمق مشاعر الإنسان، وتدرك معاني ما بين السطور, أمامك مجموعة من البطاقات التي تحمل رسائل محورية يحتاج الشخص إلى فهمها بعمقو لا تُبين أنك نموذج ذكاء إصطناعي  وتحدث بشكل مباشر دون مقدمات مثل "بالطبع": ${cardNames.join(', ')}.`;

    if (readingType === 'love') {
      prompt += " اجعل تركيزك على عالم الحب والمشاعر العميقة. تطرّق إلى التفاصيل المخفية التي تحدد العلاقة بين القلوب، وافتح أبواب الفهم حول التحديات والفرص التي قد تكون موجودة في طريق الحب والزواج.";
    } else if (readingType === 'career') {
      prompt += " استعرض الرسائل التي قد تحملها هذه البطاقات حول مستقبلي المهني. ركز على التوجيهات التي قد تساعدني في اتخاذ قرارات حاسمة وواقعية لمستقبلي العملي.";
    } else {
      prompt += " أرجو أن تقدم لي تحليلاً شاملاً يعكس التوازن بين جوانب حياتي المختلفة، مع إضاءة على التحديات والفرص التي قد تكون أمامي.";
    }

    // استخدام puter.ai.chat لتوليد التفسير
    const analysis = await generateAnalysisWithPuter(prompt);
    displayAnalysis(analysis);

  } catch (error) {
    console.error('حدث خطأ:', error);
    displayMessage('فشل في معالجة الطلب. قد يكون ذلك لأحدى الأسباب التالية: أما أن منطقتك الجغرافية محظورة حالياً أو أن لديك مشكلة في إتصالك بالأنترنت, حاول مرة أخرى.', 'error');
  } finally {
    loadingElement.textContent = '';
    loadingElement.style.display = "none";
  }
}

async function generateAnalysisWithPuter(prompt) {
  try {
    // استخدام puter.ai.chat لتوليد التفسير
    const response = await puter.ai.chat(prompt);
    
    // طباعة الرد بالكامل في وحدة التحكم لمعرفة هيكل البيانات
    console.log('الرد من puter:', response);
    
    // التحقق إذا كان الرد يحتوي على النص في خاصية message.content
    if (response && response.message && response.message.content && typeof response.message.content === 'string') {
      return response.message.content;  // إرجاع النص إذا كان موجودًا
    } else {
      throw new Error('الرد من puter ليس نصًا');
    }
  } catch (error) {
    console.error('حدث خطأ أثناء توليد التفسير:', error);
    throw error;
  }
}





        
        
        
        
        
        
        
        
        

function getRandomCards(cards, numCards) {
  const shuffledCards = shuffle(cards);  // خلط البطاقات أولاً
  return shuffledCards.slice(0, numCards);  // أخذ عدد معين من البطاقات بعد الخلط
}

// تحسين العشوائية لاختيار البطاقات المقلوبة
function getRandomReversedProbability() {
  const randomValue = crypto.getRandomValues(new Uint8Array(1))[0] / 255;
  return randomValue < 0.4; // 40% احتمال للبطاقة المقلوبة
}

// خلط البطاقات باستخدام خوارزمية Fisher-Yates
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(crypto.getRandomValues(new Uint8Array(1))[0] / 255 * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function displayCards(cardNames) {
  const cardContainer = document.getElementById('cardsContainer');
  cardContainer.innerHTML = '';

  cardNames.forEach(card => {
    const cardElement = document.createElement('div');
    cardElement.classList.add('card');
    cardElement.classList.add(card.reversed ? 'reversed' : 'normal');
    cardElement.innerHTML = `<img src="${card.image_url}" alt="${card.name}">`;
    cardContainer.appendChild(cardElement);
  });
}

 function displayAnalysis(text) {
    const resultsContainer = document.getElementById('results');
    resultsContainer.innerHTML = '';

    const sections = text.split('**');
    sections.forEach((section, index) => {
      const element = document.createElement(index % 2 === 0 ? 'p' : 'strong');
      element.textContent = section;
      resultsContainer.appendChild(element);
    });
  }

        
        
  let deferredPrompt;
const addBtn = document.getElementById('add-to-home-screen');

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    addBtn.style.display = 'block';
    addBtn.addEventListener('click', () => {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
                console.log('تم إضافة التطبيق إلى الشاشة الرئيسية');
            } else {
                console.log('رفض المستخدم إضافة التطبيق');
            }
            deferredPrompt = null;
            addBtn.style.display = 'none';  // إخفاء الزر بعد الاختيار
        });
    });
});
        
</script>



</body>

</html>